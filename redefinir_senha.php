<?phprequire_once 'config.php';require_once 'includes/db.php';$token = $_GET['token'] ?? '';$token_valido = false;if (!empty($token)) {    try {        $pdo = conectar();                // Abordagem mais robusta: verifica as tabelas separadamente        // e usa o tempo do PHP para a comparação, evitando problemas de fuso horário.        $agora = (new DateTime('now', new DateTimeZone('America/Sao_Paulo')))->format('Y-m-d H:i:s');                // 1. Procura na tabela de psicólogos        $stmt_psicologo = $pdo->prepare("SELECT id FROM psicologos WHERE token_reset_senha = ? AND token_reset_expiracao > ?");        $stmt_psicologo->execute([$token, $agora]);                if ($stmt_psicologo->fetch()) {            $token_valido = true;        } else {            // 2. Se não encontrou, procura na tabela de pacientes            $stmt_paciente = $pdo->prepare("SELECT id FROM pacientes WHERE token_reset_senha = ? AND token_reset_expiracao > ?");            $stmt_paciente->execute([$token, $agora]);            if ($stmt_paciente->fetch()) {                $token_valido = true;            }        }    } catch (Exception $e) {        error_log("Erro ao validar token de redefinição: " . $e->getMessage());        // Mantém $token_valido como false em caso de erro    }}?><!DOCTYPE html><html lang="pt-BR"><head>    <meta charset="UTF-8">    <title>Redefinir Senha</title>    <script src="https://cdn.tailwindcss.com"></script>    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet"></head><body class="bg-gray-50">    <div class="min-h-screen flex items-center justify-center p-4">        <div class="max-w-md w-full bg-white p-8 rounded-lg shadow-lg">            <h2 class="text-3xl font-bold text-center text-teal-700 mb-8">Crie uma Nova Senha</h2>            <?php if ($token_valido): ?>                <form action="processa_redefinir_senha.php" method="POST">                    <input type="hidden" name="token" value="<?php echo htmlspecialchars($token); ?>">                    <div class="mb-4">                        <label for="senha" class="block text-gray-700 text-sm font-bold mb-2">Nova Senha</label>                        <input type="password" name="senha" id="senha" required class="shadow appearance-none border rounded w-full py-3 px-4">                    </div>                    <div class="mb-6">                        <label for="confirma_senha" class="block text-gray-700 text-sm font-bold mb-2">Confirmar Nova Senha</label>                        <input type="password" name="confirma_senha" id="confirma_senha" required class="shadow appearance-none border rounded w-full py-3 px-4">                    </div>                    <button type="submit" class="w-full bg-teal-600 hover:bg-teal-700 text-white font-bold py-3 px-4 rounded">Redefinir Senha</button>                </form>            <?php else: ?>                <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded text-center">                    <p>Link inválido ou expirado. Por favor, solicite um novo link de recuperação.</p>                    <a href="esqueci_senha.php" class="font-bold mt-4 inline-block">Solicitar Novo Link</a>                </div>            <?php endif; ?>        </div>    </div></body></html>