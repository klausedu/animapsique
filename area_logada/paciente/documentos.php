<?phprequire_once '../../config.php';require_once '../../includes/auth_paciente.php';require_once '../../includes/db.php';$page_title = 'Meus Documentos';require_once 'templates/header.php';try {    $pdo = conectar();    // Busca todos os documentos enviados pelo paciente logado    $stmt = $pdo->prepare("SELECT id, nome_arquivo, data_upload FROM documentos WHERE paciente_id = ? ORDER BY data_upload DESC");    $stmt->execute([$paciente_id]);    $documentos = $stmt->fetchAll();} catch (PDOException $e) {    error_log("Erro ao buscar documentos do paciente: " . $e->getMessage());    $documentos = [];}?><div class="container mx-auto px-4 sm:px-6 lg:px-8">    <!-- Seção de Upload de Novo Documento -->    <div class="bg-white p-6 rounded-lg shadow-md mb-8">        <h2 class="text-2xl font-bold text-gray-800 mb-4">Enviar Novo Documento</h2>        <!-- Mensagens de feedback -->        <div id="feedback-message" class="hidden mb-4"></div>        <form id="uploadForm" action="processa_documento.php" method="POST" enctype="multipart/form-data">            <input type="hidden" name="action" value="create">            <div>                <label for="arquivo" class="block text-sm font-medium text-gray-700">Selecione o arquivo</label>                <div class="mt-2 flex items-center">                    <input type="file" name="arquivo" id="arquivo" required class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-teal-50 file:text-teal-700 hover:file:bg-teal-100">                </div>                <p class="mt-1 text-xs text-gray-500">Tipos permitidos: PDF, JPG, PNG, DOCX. Tamanho máximo: 5MB.</p>            </div>            <div class="mt-4 text-right">                <button type="submit" class="inline-flex items-center rounded-md border border-transparent bg-teal-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-teal-700">                    Enviar Documento                </button>            </div>        </form>    </div>    <!-- Lista de Documentos Enviados -->    <div class="bg-white p-6 rounded-lg shadow-md">        <h2 class="text-2xl font-bold text-gray-800 mb-4">Histórico de Envios</h2>        <div class="overflow-x-auto">            <table class="min-w-full divide-y divide-gray-200">                <thead class="bg-gray-50">                    <tr>                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nome do Arquivo</th>                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data de Envio</th>                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ação</th>                    </tr>                </thead>                <tbody id="documentos-table-body" class="bg-white divide-y divide-gray-200">                    <?php if (empty($documentos)): ?>                        <tr id="no-docs-row"><td colspan="3" class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center">Nenhum documento enviado ainda.</td></tr>                    <?php else: ?>                        <?php foreach ($documentos as $doc): ?>                            <tr id="doc-row-<?php echo $doc['id']; ?>">                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-teal-600">                                    <?php echo htmlspecialchars($doc['nome_arquivo']); ?>                                </td>                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">                                    <?php echo (new DateTime($doc['data_upload']))->format('d/m/Y \à\s H:i'); ?>                                </td>                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">                                    <button type="button" class="text-red-600 hover:text-red-800 delete-doc-btn" data-id="<?php echo $doc['id']; ?>">Excluir</button>                                </td>                            </tr>                        <?php endforeach; ?>                    <?php endif; ?>                </tbody>            </table>        </div>    </div></div><script>document.addEventListener('DOMContentLoaded', function() {    const uploadForm = document.getElementById('uploadForm');    const feedbackDiv = document.getElementById('feedback-message');    const tableBody = document.getElementById('documentos-table-body');    // Lida com o envio de novos documentos    uploadForm.addEventListener('submit', function(e) {        e.preventDefault();        const formData = new FormData(uploadForm);        fetch('processa_documento.php', { method: 'POST', body: formData })        .then(response => response.json())        .then(data => {            feedbackDiv.className = data.success                 ? 'bg-green-100 border-l-4 border-green-500 text-green-700 p-4 mb-4'                 : 'bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-4';            feedbackDiv.innerHTML = `<p>${data.message}</p>`;            feedbackDiv.classList.remove('hidden');            if (data.success) {                setTimeout(() => location.reload(), 1500);            }        })        .catch(error => console.error('Erro:', error));    });    // Lida com a exclusão de documentos    tableBody.addEventListener('click', function(e) {        if (e.target.classList.contains('delete-doc-btn')) {            const button = e.target;            const docId = button.dataset.id;            if (confirm('Tem a certeza de que deseja excluir este documento?')) {                const formData = new FormData();                formData.append('action', 'delete_documento');                formData.append('documento_id', docId);                fetch('processa_documento.php', { method: 'POST', body: formData })                .then(response => response.json())                .then(data => {                    feedbackDiv.className = data.success                         ? 'bg-green-100 border-l-4 border-green-500 text-green-700 p-4 mb-4'                         : 'bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-4';                    feedbackDiv.innerHTML = `<p>${data.message}</p>`;                    feedbackDiv.classList.remove('hidden');                    if (data.success) {                        document.getElementById(`doc-row-${docId}`).remove();                    }                })                .catch(error => console.error('Erro:', error));            }        }    });});</script><?php require_once 'templates/footer.php'; ?>