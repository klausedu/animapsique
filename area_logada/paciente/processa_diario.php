<?php/*===================================================================Conteúdo para: area_logada/paciente/processa_diario.php===================================================================*/require_once '../../config.php';require_once '../../includes/auth_paciente.php';require_once '../../includes/db.php';require_once '../../includes/email.php';$titulo = trim($_POST['titulo'] ?? '');$texto = trim($_POST['texto'] ?? '');if (empty($texto)) {    $_SESSION['diario_error'] = 'O campo de texto não pode estar vazio.';    header('Location: diario.php');    exit;}try {    $pdo = conectar();    $sql = "INSERT INTO diario (paciente_id, titulo, texto) VALUES (?, ?, ?)";    $stmt = $pdo->prepare($sql);    $stmt->execute([$paciente_id, $titulo, $texto]);    // Busca o e-mail da psicóloga    $stmt_psicologa = $pdo->prepare("SELECT email, nome FROM psicologos WHERE id = 1");    $stmt_psicologa->execute();    $psicologa = $stmt_psicologa->fetch();    if ($psicologa) {        // Envia o e-mail de notificação        $assunto_email = "Nova entrada no diário de " . $_SESSION['user_nome'];        $corpo_email = "<h1>Nova Entrada no Diário</h1><p>O(A) paciente <strong>{$_SESSION['user_nome']}</strong> fez uma nova entrada no seu diário.</p><p style='margin-top: 20px; font-size: 12px; color: #888;'>Para ler a entrada, por favor, visite o portal:</p><a href='" . BASE_URL . "/login.php' style='display: inline-block; padding: 10px 20px; background-color: #0d9488; color: #ffffff; text-decoration: none; border-radius: 5px;'>Acessar ao Portal</a>";        enviar_email($psicologa['email'], $psicologa['nome'], $assunto_email, $corpo_email);    }    $_SESSION['diario_success'] = 'Nova entrada do diário salva com sucesso!';} catch (Exception $e) {    $_SESSION['diario_error'] = 'Ocorreu um erro no servidor ao tentar salvar a entrada.';    error_log("Erro ao salvar entrada do diário: " . $e->getMessage());}header('Location: diario.php');exit;?>