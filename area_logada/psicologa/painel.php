<?php// 1. Inclui o arquivo de configuração geralrequire_once '../../config.php';// 2. Inclui o verificador de autenticaçãorequire_once '../../includes/auth_psicologa.php';// 3. Inclui a conexão com o banco de dadosrequire_once '../../includes/db.php';// Define o título da página$page_title = 'Painel de Controle';// 4. Inclui o cabeçalho da páginarequire_once 'templates/header.php';// --- Lógica para buscar dados do painel (CORRIGIDA) ---try {    $pdo = conectar();    // Contar total de pacientes ativos    $stmt_pacientes = $pdo->query("SELECT COUNT(id) FROM pacientes WHERE ativo = 1");    $total_pacientes = $stmt_pacientes->fetchColumn();    // Contar agendamentos para hoje    $hoje = date('Y-m-d');    $stmt_agenda = $pdo->prepare("SELECT COUNT(id) FROM agenda WHERE DATE(data_hora_inicio) = ? AND status = 'planejado'");    $stmt_agenda->execute([$hoje]);    $agenda_hoje = $stmt_agenda->fetchColumn();    // CORREÇÃO: Contar mensagens não lidas para a psicóloga logada    $stmt_msgs = $pdo->prepare(        "SELECT COUNT(*) FROM mensagens_status WHERE usuario_id = ? AND tipo_usuario = 'psicologa' AND lida = 0"    );    $stmt_msgs->execute([$_SESSION['user_id']]);    $mensagens_nao_lidas = $stmt_msgs->fetchColumn();} catch (PDOException $e) {    // Em caso de erro, exibe uma mensagem amigável    echo '<div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4" role="alert"><p>Erro ao carregar os dados do painel.</p></div>';    error_log("Erro no painel da psicóloga: " . $e->getMessage());    // Define valores padrão para evitar mais erros    $total_pacientes = 0;    $agenda_hoje = 0;    $mensagens_nao_lidas = 0;}?><!-- Conteúdo principal do painel --><div class="container mx-auto px-4 sm:px-6 lg:px-8">    <!-- Mensagem de boas-vindas -->    <div class="bg-white p-6 rounded-lg shadow-md mb-8">        <h2 class="text-2xl font-bold text-gray-800">Olá, <?php echo htmlspecialchars($psicologa_nome); ?>!</h2>        <p class="text-gray-600 mt-2">Bem-vinda de volta à sua plataforma. Aqui está um resumo das suas atividades.</p>    </div>    <!-- Grid de cartões de resumo -->    <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3">        <!-- Card: Pacientes Ativos -->        <div class="overflow-hidden rounded-lg bg-white shadow">            <div class="p-5">                <div class="flex items-center">                    <div class="flex-shrink-0">                        <!-- Ícone -->                        <svg class="h-6 w-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-4.67c.12-.318.232-.656.326-1.003M15 19.128a9.37 9.37 0 00-2.625-.372M15 19.128c-.238-.023-.472-.044-.709-.065M7.5 14.25c0-1.628 1.322-2.95 2.95-2.95s2.95 1.322 2.95 2.95c0 1.628-1.322 2.95-2.95 2.95S7.5 15.878 7.5 14.25z" /></svg>                    </div>                    <div class="ml-5 w-0 flex-1">                        <dl>                            <dt class="truncate text-sm font-medium text-gray-500">Pacientes Ativos</dt>                            <dd>                                <div class="text-lg font-medium text-gray-900"><?php echo $total_pacientes; ?></div>                            </dd>                        </dl>                    </div>                </div>            </div>            <div class="bg-gray-50 px-5 py-3">                <div class="text-sm">                    <a href="pacientes.php" class="font-medium text-teal-700 hover:text-teal-900">Ver todos</a>                </div>            </div>        </div>        <!-- Card: Sessões Hoje -->        <div class="overflow-hidden rounded-lg bg-white shadow">            <div class="p-5">                <div class="flex items-center">                    <div class="flex-shrink-0">                        <!-- Ícone -->                        <svg class="h-6 w-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5" /></svg>                    </div>                    <div class="ml-5 w-0 flex-1">                        <dl>                            <dt class="truncate text-sm font-medium text-gray-500">Sessões para Hoje</dt>                            <dd>                                <div class="text-lg font-medium text-gray-900"><?php echo $agenda_hoje; ?></div>                            </dd>                        </dl>                    </div>                </div>            </div>            <div class="bg-gray-50 px-5 py-3">                <div class="text-sm">                    <a href="agenda.php" class="font-medium text-teal-700 hover:text-teal-900">Ver agenda</a>                </div>            </div>        </div>        <!-- Card: Mensagens Não Lidas -->        <div class="overflow-hidden rounded-lg bg-white shadow">            <div class="p-5">                <div class="flex items-center">                    <div class="flex-shrink-0">                        <!-- Ícone -->                        <svg class="h-6 w-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75" /></svg>                    </div>                    <div class="ml-5 w-0 flex-1">                        <dl>                            <dt class="truncate text-sm font-medium text-gray-500">Mensagens Novas</dt>                            <dd>                                <div class="text-lg font-medium text-gray-900"><?php echo $mensagens_nao_lidas; ?></div>                            </dd>                        </dl>                    </div>                </div>            </div>            <div class="bg-gray-50 px-5 py-3">                <div class="text-sm">                    <a href="mensagens.php" class="font-medium text-teal-700 hover:text-teal-900">Ver mensagens</a>                </div>            </div>        </div>    </div> <!-- Fim do grid --></div><?php// Inclui o rodapé da páginarequire_once 'templates/footer.php';?>