<?phprequire_once '../../config.php';require_once '../../includes/auth_psicologa.php';require_once '../../includes/db.php';// Verifica se um paciente específico foi selecionado$paciente_id = filter_input(INPUT_GET, 'paciente_id', FILTER_VALIDATE_INT);$error_message = null;try {    $pdo = conectar();    if ($paciente_id) {        // Se um paciente foi selecionado, busca os seus dados e documentos        $stmt_paciente = $pdo->prepare("SELECT nome FROM pacientes WHERE id = ?");        $stmt_paciente->execute([$paciente_id]);        $paciente = $stmt_paciente->fetch();        if (!$paciente) {            header('Location: pacientes.php');            exit;        }        $stmt_docs = $pdo->prepare("SELECT id, nome_arquivo, caminho_arquivo, data_upload FROM documentos WHERE paciente_id = ? ORDER BY data_upload DESC");        $stmt_docs->execute([$paciente_id]);        $documentos = $stmt_docs->fetchAll();        $page_title = 'Documentos de ' . htmlspecialchars($paciente['nome']);    } else {        // Se nenhum paciente foi selecionado, busca a lista de todos os pacientes        $stmt_pacientes = $pdo->query("SELECT id, nome FROM pacientes WHERE ativo = 1 ORDER BY nome ASC");        $pacientes = $stmt_pacientes->fetchAll();        $page_title = 'Documentos dos Pacientes';    }} catch (PDOException $e) {    $error_message = "Erro na base de dados. Por favor, tente mais tarde.";    error_log("Erro em documentos_paciente.php: " . $e->getMessage());    $pacientes = [];    $documentos = [];    $paciente = null;}require_once __DIR__ . '/templates/header.php';?><div class="container mx-auto px-4 sm:px-6 lg:px-8">    <?php if ($error_message): ?>        <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-4" role="alert">            <p><?php echo $error_message; ?></p>        </div>    <?php elseif ($paciente_id && $paciente): // --- VISÃO DOS DOCUMENTOS DE UM PACIENTE --- ?>            <div class="bg-white p-6 rounded-lg shadow-md">            <div class="flex justify-between items-start mb-6">                 <h2 class="text-2xl font-bold text-gray-800">Documentos Enviados por <?php echo htmlspecialchars($paciente['nome']); ?></h2>                 <!-- BOTÃO VOLTAR CORRIGIDO -->                 <a href="pacientes.php" class="text-sm text-teal-600 hover:text-teal-800">&larr; Voltar para a lista de pacientes</a>            </div>                        <table class="min-w-full divide-y divide-gray-200">                <thead class="bg-gray-50">                    <tr>                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Nome do Arquivo</th>                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Data de Envio</th>                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ação</th>                    </tr>                </thead>                <tbody class="bg-white divide-y divide-gray-200">                    <?php if (empty($documentos)): ?>                        <tr><td colspan="3" class="px-6 py-4 text-center text-gray-500">Nenhum documento enviado.</td></tr>                    <?php else: ?>                        <?php foreach ($documentos as $doc): ?>                            <tr>                                <td class="px-6 py-4 text-sm font-medium text-gray-900"><?php echo htmlspecialchars($doc['nome_arquivo']); ?></td>                                <td class="px-6 py-4 text-sm text-gray-500"><?php echo (new DateTime($doc['data_upload']))->format('d/m/Y H:i'); ?></td>                                <td class="px-6 py-4 text-sm font-medium">                                    <a href="../../uploads/documentos/<?php echo htmlspecialchars($doc['caminho_arquivo']); ?>" target="_blank" class="text-indigo-600 hover:text-indigo-900">Baixar Arquivo</a>                                </td>                            </tr>                        <?php endforeach; ?>                    <?php endif; ?>                </tbody>            </table>        </div>    <?php else: // --- VISÃO DE SELEÇÃO DE PACIENTES --- ?>        <div class="bg-white p-6 rounded-lg shadow-md">            <h2 class="text-2xl font-bold text-gray-800 mb-4">Selecionar Paciente</h2>            <p class="text-gray-600 mb-6">Escolha um paciente para ver os documentos que ele enviou.</p>            <ul class="divide-y divide-gray-200">                <?php if (empty($pacientes)): ?>                    <li class="py-4 text-center text-gray-500">Nenhum paciente ativo encontrado.</li>                <?php else: ?>                    <?php foreach ($pacientes as $paciente_item): ?>                        <li class="py-4">                            <a href="documentos_paciente.php?paciente_id=<?php echo $paciente_item['id']; ?>" class="flex items-center justify-between hover:bg-gray-50 p-2 rounded-md">                                <span class="text-lg font-medium text-teal-700"><?php echo htmlspecialchars($paciente_item['nome']); ?></span>                                <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z" clip-rule="evenodd" /></svg>                            </a>                        </li>                    <?php endforeach; ?>                <?php endif; ?>            </ul>        </div>    <?php endif; ?></div><?php require_once __DIR__ . '/templates/footer.php'; ?>